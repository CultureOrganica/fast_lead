# Implementation Plan: Веб-платформа и личный кабинет Fast Lead

## Смысл и цель задачи

Создать полноценную SaaS-платформу для управления омниканальным appointment-setter. Платформа позволит клиентам самостоятельно настраивать виджет, управлять каналами, анализировать конверсию и оплачивать подписку. Результат: работающий MVP веб-приложения с публичным сайтом, личным кабинетом, биллингом и базовой аналитикой для запуска на российский рынок.

## Архитектура решения

### Публичный сайт (Marketing)

- Landing page с описанием продукта
- Страница Pricing с тарифными планами в рублях
- Страница Features с демо виджета
- Страница Use Cases (для разных индустрий)
- Блог для SEO и контент-маркетинга
- Размещение: frontend/marketing/

### Личный кабинет (Dashboard)

- Единая точка входа для клиентов
- Обзорная панель с метриками (лиды, конверсия, каналы)
- Настройки виджета (дизайн, тексты, каналы)
- Управление интеграциями (календари, CRM, каналы)
- Просмотр истории лидов и диалогов
- Team management (пользователи, роли)
- Размещение: frontend/dashboard/

### Onboarding

- Guided tour для новых пользователей
- Пошаговая настройка первого виджета
- Интеграция с календарем и первым каналом
- Тестирование виджета на демо-странице
- Размещение: frontend/onboarding/

### Биллинг

- Выбор тарифного плана
- Интеграция с ЮКасса и Тинькофф для приема платежей
- Управление подпиской (апгрейд/даунгрейд)
- История платежей и счета
- Размещение: frontend/billing/

### Аналитика

- Дашборд с ключевыми метриками
- Графики конверсии по каналам
- Воронка от лида до брони
- Экспорт данных в CSV/Excel
- Размещение: frontend/analytics/

### Бэкенд API платформы

- REST API для фронтенда
- Аутентификация (JWT, OAuth)
- CRUD операции для tenant, widget config, users
- Интеграция с биллингом
- Размещение: backend/platform-api/

### Хранилище

- Postgres для tenants, users, subscriptions, widget configs
- Redis для сессий и кэша
- S3-совместимое хранилище для медиа (логотипы, аватары)

### Размещение компонентов

- Публичный сайт и dashboard: CDN (Cloudflare) + static hosting
- Бэкенд API: существующая инфраструктура
- Медиа: S3-совместимое хранилище (Selectel, VK Cloud)

## Полный flow работы функционала

1. **Регистрация клиента**
   - Потенциальный клиент заходит на публичный сайт
   - Изучает pricing и features
   - Нажимает "Попробовать бесплатно" (14 дней trial)
   - Регистрируется через email или OAuth (Google, Яндекс)
   - Подтверждает email

2. **Onboarding новичка**
   - Guided tour показывает основные разделы
   - Пользователь создает первый tenant (компания/проект)
   - Настраивает базовые параметры виджета (название, цвет, текст приветствия)
   - Подключает первый канал (например, web-чат или Telegram)
   - Интегрирует календарь (Cal.com)
   - Получает код для вставки виджета на сайт
   - Тестирует на демо-странице

3. **Настройка виджета**
   - В разделе Widget Settings настраивает внешний вид
   - Выбирает доступные каналы (SMS, Email, Telegram, WhatsApp, MAX)
   - Настраивает тексты приветствий и быстрых ответов
   - Загружает логотип и аватар оператора
   - Настраивает согласия (GDPR, marketing)
   - Копирует сниппет для вставки на сайт

4. **Управление каналами**
   - В разделе Channels подключает провайдеров
   - Добавляет API ключи для SMS (Twilio, SMSC.ru)
   - Настраивает email sender (SendGrid, AWS SES)
   - Подключает Telegram бот (Bot Token)
   - Настраивает WhatsApp Business API
   - Тестирует каждый канал отдельно

5. **Работа с лидами**
   - В разделе Leads просматривает список всех лидов
   - Фильтрует по статусу (new, contacted, booked, lost)
   - Видит историю коммуникаций с каждым лидом
   - Может вручную эскалировать в инбокс
   - Экспортирует данные в CSV

6. **Аналитика и оптимизация**
   - В разделе Analytics видит дашборд с метриками
   - Анализирует конверсию по каналам
   - Видит время ответа (time-to-first-contact)
   - Отслеживает воронку от лида до брони
   - Оптимизирует настройки виджета на основе данных

7. **Управление командой**
   - В разделе Team добавляет коллег
   - Назначает роли (admin, operator, analyst)
   - Настраивает права доступа
   - Приглашает по email

8. **Биллинг и подписка**
   - Trial заканчивается через 14 дней
   - Система предлагает выбрать тарифный план
   - Клиент выбирает план (Старт/Про/Бизнес)
   - Оплачивает через ЮКасса или Тинькофф
   - Получает доступ к расширенным функциям
   - Может апгрейдить или даунгрейдить план в любой момент

9. **Ongoing использование**
   - Получает еженедельный email с метриками
   - Настраивает алерты при важных событиях
   - Обновляет настройки виджета при необходимости
   - Продлевает подписку автоматически

## API и интерфейсы

### Platform API

#### Authentication

**register**
- **Назначение**: регистрация нового пользователя
- **Параметры**: email, password, name, company
- **Возвращает**: userId, accessToken, refreshToken
- **Ошибки**: 400 валидация, 409 email уже существует

**login**
- **Назначение**: вход в систему
- **Параметры**: email, password
- **Возвращает**: accessToken, refreshToken, user profile
- **Ошибки**: 401 неверные credentials

**refreshToken**
- **Назначение**: обновление access token
- **Параметры**: refreshToken
- **Возвращает**: новый accessToken
- **Ошибки**: 401 невалидный refresh token

#### Tenants

**createTenant**
- **Назначение**: создать новый tenant (проект)
- **Параметры**: name, description, domain, settings
- **Возвращает**: tenantId, config
- **Ошибки**: 400 валидация, 403 лимит по плану

**getTenant**
- **Назначение**: получить данные tenant
- **Параметры**: tenantId
- **Возвращает**: tenant данные, widget config, channels
- **Ошибки**: 404 не найден, 403 нет доступа

**updateTenant**
- **Назначение**: обновить настройки tenant
- **Параметры**: tenantId, updates (name, settings)
- **Возвращает**: обновленный tenant
- **Ошибки**: 400 валидация, 404 не найден

#### Widget Configuration

**getWidgetConfig**
- **Назначение**: получить конфигурацию виджета
- **Параметры**: tenantId
- **Возвращает**: полный config виджета (UI, channels, texts)
- **Ошибки**: 404 не найден

**updateWidgetConfig**
- **Назначение**: обновить настройки виджета
- **Параметры**: tenantId, config (colors, texts, logo, channels)
- **Возвращает**: обновленный config
- **Ошибки**: 400 валидация

**getWidgetSnippet**
- **Назначение**: получить код для вставки на сайт
- **Параметры**: tenantId
- **Возвращает**: JavaScript сниппет
- **Ошибки**: 404 tenant не найден

#### Channels

**listChannels**
- **Назначение**: список подключенных каналов
- **Параметры**: tenantId
- **Возвращает**: массив каналов с статусами
- **Ошибки**: 403 нет доступа

**connectChannel**
- **Назначение**: подключить новый канал
- **Параметры**: tenantId, channelType, credentials (apiKey, token и т.д.)
- **Возвращает**: channelId, статус подключения
- **Ошибки**: 400 невалидные credentials, 409 канал уже подключен

**testChannel**
- **Назначение**: протестировать канал
- **Параметры**: tenantId, channelId, testMessage
- **Возвращает**: статус теста, результат отправки
- **Ошибки**: 400 ошибка провайдера

#### Leads

**getLeads**
- **Назначение**: получить список лидов
- **Параметры**: tenantId, filters (status, channel, dateRange), pagination
- **Возвращает**: массив лидов с метаданными
- **Ошибки**: 400 невалидные фильтры

**getLead**
- **Назначение**: детали конкретного лида
- **Параметры**: tenantId, leadId
- **Возвращает**: полная информация о лиде, история коммуникаций
- **Ошибки**: 404 не найден

**exportLeads**
- **Назначение**: экспорт лидов в CSV
- **Параметры**: tenantId, filters, format
- **Возвращает**: CSV файл или ссылка на скачивание
- **Ошибки**: 400 невалидные параметры

#### Analytics

**getDashboard**
- **Назначение**: получить метрики для дашборда
- **Параметры**: tenantId, dateRange
- **Возвращает**: агрегированные метрики (leads count, conversion, avg response time)
- **Ошибки**: 400 невалидный date range

**getChannelStats**
- **Назначение**: статистика по каналам
- **Параметры**: tenantId, dateRange
- **Возвращает**: breakdown по каналам с конверсией
- **Ошибки**: 400 невалидные параметры

**getFunnel**
- **Назначение**: данные воронки
- **Параметры**: tenantId, dateRange
- **Возвращает**: этапы воронки с conversion rate
- **Ошибки**: 400 невалидные параметры

#### Team

**listTeamMembers**
- **Назначение**: список членов команды
- **Параметры**: tenantId
- **Возвращает**: массив пользователей с ролями
- **Ошибки**: 403 нет прав

**inviteTeamMember**
- **Назначение**: пригласить нового члена команды
- **Параметры**: tenantId, email, role
- **Возвращает**: inviteId, статус отправки приглашения
- **Ошибки**: 400 невалидный email, 403 лимит по плану

**updateTeamMember**
- **Назначение**: изменить роль члена команды
- **Параметры**: tenantId, userId, newRole
- **Возвращает**: обновленная информация
- **Ошибки**: 403 нет прав, 404 пользователь не найден

#### Billing

**getSubscription**
- **Назначение**: получить данные подписки
- **Параметры**: tenantId
- **Возвращает**: текущий план, статус, дата продления
- **Ошибки**: 404 подписка не найдена

**changePlan**
- **Назначение**: сменить тарифный план
- **Параметры**: tenantId, newPlanId, prorated
- **Возвращает**: новая подписка, сумма к оплате
- **Ошибки**: 400 невалидный план, 402 ошибка платежа

**createPayment**
- **Назначение**: создать платеж
- **Параметры**: tenantId, planId, paymentMethod
- **Возвращает**: paymentUrl для редиректа (ЮКасса/Тинькофф)
- **Ошибки**: 400 невалидные данные

**getInvoices**
- **Назначение**: получить историю счетов
- **Параметры**: tenantId, pagination
- **Возвращает**: массив счетов с PDF ссылками
- **Ошибки**: 403 нет доступа

## Взаимодействие компонентов

```
User Browser -> Marketing Site -> Sign Up -> Auth API -> Dashboard
Dashboard -> Platform API -> Database (Tenants, Users, Config)
Dashboard -> Widget Config API -> Widget CDN
Dashboard -> Billing API -> Payment Provider (ЮКасса/Тинькофф)
Dashboard -> Analytics API -> Analytics Database
Widget (Client Site) -> Public API -> Orchestrator (из задачи 01)
```

### Детальный flow регистрации и setup

1. User нажимает "Попробовать бесплатно" на Marketing Site
2. Auth API создает user и tenant, отправляет confirmation email
3. User подтверждает email и логинится
4. Dashboard показывает Onboarding wizard
5. User настраивает виджет через Widget Config API
6. Widget Config API генерирует сниппет и сохраняет в CDN
7. User вставляет сниппет на свой сайт
8. Виджет загружается с CDN и начинает работать (задача 01)

## Порядок реализации

### Фаза 1: Публичный сайт и регистрация

1. **Публичный сайт (Marketing)**
   - Landing page с hero section, features, use cases
   - Pricing page с тарифными планами в рублях
   - Features page с демо виджета
   - Адаптивный дизайн (mobile-first)
   - SEO оптимизация

2. **Аутентификация и регистрация**
   - Sign up / Sign in формы
   - Email подтверждение
   - Восстановление пароля
   - OAuth интеграция (Google, Яндекс)
   - JWT-based аутентификация

### Фаза 2: Базовый личный кабинет

3. **Dashboard layout**
   - Навигация (sidebar, header)
   - Обзорная страница с заглушками метрик
   - Profile settings
   - Responsive дизайн

4. **Tenant management**
   - Создание первого tenant
   - Базовые настройки (название, домен)
   - Переключение между tenants (для мульти-проектов)

### Фаза 3: Настройка виджета

5. **Widget configurator**
   - Visual editor для настройки виджета
   - Preview в реальном времени
   - Настройка цветов, текстов, логотипа
   - Выбор доступных каналов
   - Генерация сниппета для вставки

6. **Channels management**
   - UI для подключения каналов
   - Формы для ввода API ключей
   - Тестирование каналов
   - Индикаторы статуса (connected/error)

### Фаза 4: Работа с лидами

7. **Leads list**
   - Таблица с лидами
   - Фильтры (статус, канал, дата)
   - Пагинация
   - Поиск

8. **Lead details**
   - Детальная страница лида
   - История коммуникаций
   - Временная шкала событий
   - Действия (эскалация, закрытие)

### Фаза 5: Аналитика

9. **Analytics dashboard**
   - Ключевые метрики (cards)
   - Графики конверсии
   - Breakdown по каналам
   - Воронка

10. **Export functionality**
    - Экспорт лидов в CSV
    - Экспорт аналитики
    - Планировщик регулярных отчетов

### Фаза 6: Биллинг

11. **Subscription management**
    - Выбор тарифного плана
    - Интеграция с ЮКасса
    - Интеграция с Тинькофф
    - История платежей

12. **Invoicing**
    - Генерация счетов
    - Автоматические счета фактуры
    - Email уведомления о платежах

### Фаза 7: Командная работа

13. **Team management**
    - Приглашение членов команды
    - Управление ролями
    - Permissions

14. **Onboarding wizard**
    - Guided tour для новых пользователей
    - Пошаговая настройка
    - Interactive tutorials

## Критичные граничные случаи

### Trial окончание без оплаты

- **Проблема**: trial закончился, а пользователь не оплатил
- **Решение**: мягкая деградация - виджет продолжает работать в read-only режиме 7 дней, затем полная блокировка с сохранением данных

### Ошибка платежа

- **Проблема**: платеж не прошел (недостаточно средств, отклонен банком)
- **Решение**: 3 попытки автоплатежа с интервалом 3 дня, email уведомления, grace period 7 дней

### Превышение лимитов плана

- **Проблема**: пользователь превысил лимит лидов или запросов по текущему плану
- **Решение**: предложение апгрейда, временная блокировка новых лидов до апгрейда или следующего месяца

### Невалидные API ключи каналов

- **Проблема**: пользователь ввел неверный API ключ для SMS/Email провайдера
- **Решение**: валидация при вводе через test запрос, clear error messages, disable канала до исправления

### Потеря сессии

- **Проблема**: JWT token истек во время работы
- **Решение**: автоматический refresh token в фоне, fallback на logout с сохранением текущей страницы для редиректа после логина

### Конфликты при одновременном редактировании

- **Проблема**: два админа редактируют настройки виджета одновременно
- **Решение**: optimistic locking с version field, уведомление о конфликте, предложение overwrite или merge

## Объем работ

### Что входит в реализацию

- Публичный сайт (landing, pricing, features)
- Аутентификация и регистрация (email, OAuth)
- Личный кабинет (dashboard, navigation)
- Tenant management
- Widget configurator с preview
- Channels management UI
- Leads list и details
- Analytics dashboard
- Export в CSV
- Биллинг (ЮКасса, Тинькофф)
- Team management
- Onboarding wizard
- Email уведомления (welcome, trial ending, payment)
- Responsive дизайн

## Что не входит

### Не реализуется в рамках MVP

- Продвинутая персонализация виджета (кастомный CSS)
- Белый label (custom domain для виджета)
- API для внешних интеграций
- Webhook конфигуратор
- Продвинутая аналитика (cohort analysis, attribution)
- A/B тестирование виджетов
- Multi-language интерфейса (пока только русский)
- Mobile приложение
- Advanced permissions (custom roles)
- SSO (Single Sign-On)
- Audit log
- Data retention policies
- GDPR self-service (право на удаление данных - только по запросу)

## Допущения

### Ключевые допущения, влияющие на архитектуру

1. Клиенты готовы платить в рублях ежемесячно (без годовых планов в MVP)
2. Email подтверждение достаточно для верификации пользователя
3. Основная аудитория - малый и средний бизнес в РФ
4. ЮКасса и Тинькофф достаточно для приема платежей (без криптовалют и зарубежных карт)
5. Один tenant = один виджет (мульти-виджеты не требуются в MVP)
6. Русский язык интерфейса достаточен для запуска
7. Клиенты имеют базовые технические навыки для вставки сниппета на сайт
8. Trial 14 дней достаточен для оценки продукта
9. Не требуется compliance с международными стандартами (только базовая GDPR)
10. Существующая инфраструктура выдержит до 1000 активных tenants

## Открытые вопросы

### Вопросы, требующие ответа заказчика или тимлида

1. Какие конкретные тарифные планы и цены? (предложение: Старт 4990р, Про 9990р, Бизнес 19990р)
2. Какие лимиты по лидам на каждый план? (предложение: Старт 500, Про 2000, Бизнес unlimited)
3. Нужна ли интеграция с VK для российского рынка?
4. Требуется ли юридическое лицо в РФ для работы с ЮКасса/Тинькофф или можно ИП?
5. Какой grace period при неоплате после trial? (предложение: 7 дней)
6. Нужен ли реферальный функционал для привлечения клиентов?
7. Требуется ли интеграция с российскими CRM (Битрикс24, amoCRM)?
8. Какой домен для платформы? (fast-lead.ru, fastlead.io?)
9. Нужна ли поддержка юрлиц (выставление счетов, акты)?
10. Какой SLA для технической поддержки клиентов?

## Acceptance criteria

### Измеримые условия приемки для happy path

1. Пользователь может зарегистрироваться через email и получить письмо подтверждения
2. После подтверждения email пользователь попадает в onboarding wizard
3. Onboarding проводит через создание tenant, настройку виджета, подключение одного канала
4. Пользователь получает сниппет для вставки на сайт
5. В личном кабинете отображается список лидов (mock data для начала)
6. Analytics dashboard показывает базовые метрики (mock data)
7. Пользователь может подключить SMS или Email канал через ввод API ключа
8. Тест канала работает и показывает статус
9. Trial заканчивается через 14 дней, показывается предложение оплатить
10. Пользователь может выбрать план и оплатить через ЮКасса
11. После оплаты подписка активируется, виджет продолжает работать
12. Пользователь может пригласить члена команды по email
13. Invited member получает email и может зарегистрироваться
14. Экспорт лидов в CSV работает и возвращает файл

### Ручной сценарий проверки без автотестов

**Сценарий 1: Регистрация и onboarding**
1. Открыть landing page
2. Нажать "Попробовать бесплатно"
3. Зарегистрироваться с email
4. Подтвердить email по ссылке
5. Пройти onboarding wizard
6. Убедиться что виджет настроен и сниппет получен

**Сценарий 2: Настройка виджета**
1. Войти в личный кабинет
2. Перейти в Widget Settings
3. Изменить цвет виджета
4. Загрузить логотип
5. Изменить текст приветствия
6. Сохранить изменения
7. Убедиться что preview обновился

**Сценарий 3: Подключение канала**
1. Перейти в Channels
2. Выбрать SMS (Twilio)
3. Ввести API ключ
4. Нажать "Test connection"
5. Убедиться что статус "Connected"

**Сценарий 4: Работа с лидами**
1. Перейти в Leads
2. Просмотреть список лидов
3. Отфильтровать по статусу "new"
4. Открыть детали лида
5. Просмотреть историю
6. Экспортировать в CSV

**Сценарий 5: Биллинг**
1. Trial истекает (или форсировать окончание)
2. Получить email о необходимости оплаты
3. Перейти в Billing
4. Выбрать план "Про"
5. Нажать "Оплатить"
6. Перейти на ЮКасса
7. Оплатить тестовой картой
8. Вернуться в dashboard
9. Убедиться что подписка активна

## Definition of Done

1. Код и конфиги добавлены в репозиторий по структуре проекта
2. README платформы с инструкцией по деплою
3. Все страницы responsive и работают на мобильных
4. Формы валидируются на клиенте и сервере
5. Прошел code review
6. Ручное тестирование выполнено по сценариям выше
7. Email уведомления настроены и тестированы
8. Интеграция с ЮКасса протестирована в sandbox
9. Секреты вынесены в секрет-хранилище
10. Логи и базовые метрики включены
11. Фича зафлажена и может быть отключена без деплоя

## Минимальные NFR для MVP

### Производительность

- Время загрузки landing page до 2 с (p95)
- Время загрузки dashboard до 3 с (p95)
- API запросы обрабатываются за 300 мс (p95)
- Генерация сниппета виджета за 500 мс
- Экспорт до 10000 лидов за 10 секунд

### Надежность

- Uptime 99% для публичного сайта
- Uptime 99% для dashboard
- Автоматический retry при ошибках платежных провайдеров
- Graceful degradation при недоступности analytics

### Ограничения

- Максимум 10 members в команде на плане "Старт"
- Максимум 5 tenants на одного пользователя
- Максимум 100 МБ на медиа файлы (логотипы, аватары) на tenant
- Rate-limit: 100 req/min на пользователя для Platform API

### Масштабируемость

- Поддержка до 1000 активных tenants в MVP
- До 100000 лидов в месяц по всем tenants
- Горизонтальное масштабирование веб-серверов

## Требования безопасности

### Аутентификация и авторизация

- Пароли хэшируются bcrypt с cost factor 12
- JWT токены с коротким TTL (15 мин access, 7 дней refresh)
- RBAC для разграничения доступа (admin, operator, analyst)
- CSRF protection для всех form submissions

### Секреты

- Секреты только из секрет-хранилища (не в коде)
- API ключи каналов шифруются в базе данных
- Ротация JWT secret каждые 90 дней

### PII

- PII не логировать
- Маскирование данных в UI для ролей с ограниченным доступом
- HTTPS only для всех запросов
- Secure cookies (httpOnly, secure, sameSite)

### Платежи

- PCI DSS compliance через использование ЮКасса/Тинькофф (без хранения карт)
- Webhook signature verification от платежных провайдеров

### Сеть

- CORS настроен для доверенных доменов
- Rate-limiting для защиты от brute-force (5 попыток логина за 15 мин)
- XSS protection через CSP headers
- Input sanitization для всех форм

## Наблюдаемость

### Логи

Ключевые события:

- user_registered (userId, email, source)
- user_logged_in (userId, ip, timestamp)
- tenant_created (tenantId, userId)
- widget_configured (tenantId, config_version)
- channel_connected (tenantId, channelType)
- subscription_created (tenantId, planId, amount)
- payment_successful (tenantId, paymentId, amount)
- payment_failed (tenantId, paymentId, error)
- team_member_invited (tenantId, inviterUserId, inviteeEmail)

### Метрики

Бизнес-метрики:

- Новые регистрации (по дням)
- Trial to paid conversion rate
- Churn rate
- MRR (Monthly Recurring Revenue)
- ARPU (Average Revenue Per User)
- Активные tenants
- Leads processed (по всем tenants)

Технические метрики:

- Latency API endpoints (p50, p95, p99)
- Error rate (4xx, 5xx)
- Uptime dashboard и marketing site
- Database connection pool usage
- Cache hit rate (Redis)

### Трассировка

- Request tracing через correlation ID
- Span от user action в dashboard до API response
- Интеграция с существующей системой трассировки проекта

### Мониторинг и алерты

- Алерт при downtime публичного сайта или dashboard
- Алерт при spike в error rate (>5%)
- Алерт при росте latency (p95 > 1s)
- Алерт при падении trial conversion <20%
- Алерт при росте churn rate >5% за неделю

## Релиз

### Включение через feature flag

- Публичный сайт доступен сразу для всех
- Dashboard за feature flag для закрытого бета-тестирования
- Onboarding wizard за отдельным флагом
- Биллинг за флагом до полной интеграции с ЮКасса

### План развертывания по окружениям

1. **Development**: непрерывный деплой из feature branch
2. **Staging**: деплой перед релизом, приглашенные тестировщики
3. **Production beta**: ограниченный доступ для первых клиентов (whitelist)
4. **Production GA**: открытый доступ для всех

### Деплой

- Публичный сайт деплоится на CDN (static build)
- Dashboard деплоится на CDN (SPA)
- Platform API деплоится в существующую инфраструктуру
- Database миграции запускаются перед деплоем API
- Rollout strategy: blue-green deployment для минимизации downtime

### Мягкий запуск (Soft Launch)

- Закрытая бета для 50 первых клиентов
- Сбор обратной связи через in-app опросы
- Итерации на основе фидбека
- Открытие регистрации после стабилизации

## Откат

### Условия отката

- Критическая уязвимость безопасности
- Более 10% новых регистраций не могут завершить onboarding
- Более 5% платежей проваливаются
- Downtime dashboard более 30 минут
- Критический баг блокирующий работу всех пользователей

### Шаги возврата состояния

1. Переключить feature flag для dashboard (закрыть доступ)
2. Откатить деплой Platform API на предыдущую версию
3. Откатить деплой frontend на предыдущий билд
4. Откатить database миграции (если safe)
5. Уведомить активных пользователей о техработах
6. Исправить проблему в hotfix
7. Повторить деплой после фикса

## Риски и митигации

### Риск 1: Низкая trial to paid conversion

- **Митигация**: onboarding wizard для снижения порога входа, email nurturing campaign во время trial, персональные демо для крупных клиентов

### Риск 2: Проблемы с платежными провайдерами

- **Митигация**: интеграция с двумя провайдерами (ЮКасса и Тинькофф), fallback на второго при недоступности первого, мониторинг success rate платежей

### Риск 3: Высокий churn из-за сложности настройки

- **Митигация**: интуитивный UI/UX, guided onboarding, video tutorials, live chat support для пользователей на платных планах

### Риск 4: Недостаточная производительность при росте базы

- **Митигация**: горизонтальное масштабирование с самого начала, caching агрессивный, database индексы на часто запрашиваемые поля, read replicas

### Риск 5: Security breach (утечка данных)

- **Митигация**: регулярные security audits, penetration testing перед GA, bug bounty program, шифрование PII, регулярные бэкапы

### Риск 6: Юридические проблемы с обработкой данных

- **Митигация**: консультация с юристом по GDPR и 152-ФЗ, четкие terms of service и privacy policy, согласия пользователей на обработку данных

## Параметры стека

### Фронтенд

- **Framework**: React 18+ или Next.js для SSR/SSG
- **State management**: Zustand или Redux Toolkit
- **UI library**: Tailwind CSS + shadcn/ui или Ant Design
- **Forms**: React Hook Form + Zod для валидации
- **Charts**: Recharts или Apache ECharts
- **Routing**: React Router или Next.js routing

### Бэкенд

- **Язык**: Python 3.11+
- **Framework**: FastAPI или Flask
- **ORM**: SQLAlchemy или Prisma (если TypeScript backend)
- **Validation**: Pydantic
- **Auth**: PyJWT или Authlib

### База данных

- **Primary**: Postgres 14+
- **Cache**: Redis 6+
- **Драйвер**: asyncpg для async или psycopg2

### Инфраструктура

- **Hosting**: существующая платформа проекта
- **CDN**: Cloudflare для static assets
- **Object Storage**: S3-совместимое (Selectel, VK Cloud)
- **Email**: SendGrid, AWS SES или Mailgun
- **Payments**: ЮКасса SDK, Тинькофф API

### Деплой

- **CI/CD**: GitHub Actions или GitLab CI
- **Containerization**: Docker
- **Orchestration**: Kubernetes или Docker Compose (в зависимости от инфраструктуры)

## Pricing модель для российского рынка

### Предлагаемые тарифные планы

**Trial (14 дней)**
- Все функции
- До 50 лидов
- Все каналы
- 1 tenant
- Email support

**Старт - 4990 руб/мес**
- До 500 лидов/мес
- Все каналы
- 1 tenant
- До 3 членов команды
- Email support
- Базовая аналитика

**Про - 9990 руб/мес**
- До 2000 лидов/мес
- Все каналы
- До 3 tenants
- До 10 членов команды
- Priority email + chat support
- Расширенная аналитика
- Export данных
- Custom branding (логотип)

**Бизнес - 19990 руб/мес**
- Unlimited лиды
- Все каналы
- Unlimited tenants
- Unlimited команда
- Dedicated support manager
- Advanced analytics
- API access
- Webhook integrations
- Custom onboarding

**Enterprise - по запросу**
- Все из Бизнес
- On-premise deployment опция
- SLA 99.9%
- Dedicated infrastructure
- Custom integrations
- Legal entity support (счета, акты)

### Обоснование pricing

- Setter.ai от $99 = ~9900 руб (но у них per lead, дороже при масштабе)
- Наш "Старт" дешевле для привлечения малого бизнеса
- "Про" сопоставим с мировыми аналогами
- "Бизнес" дает margin для роста и поддержки

## Самопроверка плана перед выдачей

- [x] Нет кода и псевдокода, выполнено
- [x] Заполнены scope, acceptance, risk, release, pricing
- [x] Регэксп именования файлов и задач выполняется
- [x] Нет упоминаний секретов и приватных URL
- [x] Использованы только стандартные символы дефисов и пробелов
- [x] Язык: русский
- [x] Все пути в POSIX-формате

## Проверки перед ломкой API

- [x] Подтверждено отсутствие внешних потребителей Platform API (новый проект)
- [x] Нет зависимых задач в текущем спринте
- [x] Можно менять структуру API без backward compatibility

## Профиль языка

- **primary_language**: python (backend), typescript/javascript (frontend)
- **stdlib_preferred**: true для backend
- **note**: для фронтенда использовать популярные библиотеки (React ecosystem), для бэкенда предпочитать stdlib где возможно
